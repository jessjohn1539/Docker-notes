# Docker Notes

## What is Docker?
Docker is a platform designed to help developers build, share, and run containerized applications. It simplifies the process of packaging an application along with all its dependencies into a single, portable unit called a container. Containers are lightweight, portable, and ensure consistent performance across different environments, making it easy to replicate your local setup on any machine or operating system.

Docker also provides **Docker Hub**, a centralized repository similar to GitHub, where developers can share and access public collections of Docker images. These images serve as templates for creating containers.

## What is a Docker Image?
A **Docker image** is an executable file that contains all the instructions required to create a container. Think of it as a blueprint for your application environment. When you run an image, Docker creates a container based on that image.

## How Does Docker Work?
A basic example:
```bash
docker run -it ubuntu
```
This command pulls the latest Ubuntu image from Docker Hub (if not already available locally), creates a container from it, and opens an interactive terminal (`-it`) inside the container. This allows you to interact with the container's environment directly.

## Containerization vs Virtualization
Containers differ from virtual machines (VMs) in terms of architecture and resource usage:
- **Virtual Machines (VMs):** Virtualize the entire operating system, including the kernel, making them heavier and slower to start.

- **Containers :** Virtualize only the application layer, leveraging the host machine's OS kernel. This makes containers much lighter and faster compared to VMs.

## Setup Instructions
1. Install **Docker Desktop** from the official Docker website.
2. Verify the installation:
   ```bash
   docker --version
   ```
3. Check if Docker is running:
   ```bash
   docker ps
   ```

## Basic Docker Commands

### Pulling an Image
```bash
docker pull IMAGE_NAME
```
Fetches the latest version of the specified image from Docker Hub.

### Running a Container
```bash
docker run IMAGE_NAME
```
Creates and starts a new container from the specified image.

### Interactive Mode
```bash
docker run -it IMAGE_NAME
```
Starts a container in interactive mode, allowing you to access its terminal.

### Listing Containers
```bash
docker ps -a
```
Displays all running and stopped containers.

### Starting/Stopping Containers
```bash
docker start CONTAINER_NAME_OR_ID
docker stop CONTAINER_NAME_OR_ID
```
Starts or stops a specific container.

### Removing Images/Containers
```bash
docker rmi IMAGE_NAME
docker rm CONTAINER_NAME
```
Deletes an image or container permanently.

### Specifying Image Versions
```bash
docker pull IMAGE_NAME:VERSION
```
Pulls a specific version of an image.

### Setting Environment Variables
```bash
docker run -e ENV_VARIABLE=value --name CUSTOM_NAME IMAGE_NAME
```
The `-e` flag sets environment variables, while `--name` assigns a custom name to the container.

### Port Binding
```bash
docker run -p HOST_PORT:CONTAINER_PORT IMAGE_NAME
```
Maps a port on the host machine to a port inside the container.

## Troubleshooting Commands

### Viewing Logs
```bash
docker logs CONTAINER_ID
```
Displays logs generated by the container.

### Executing Commands Inside a Running Container
```bash
docker exec -it CONTAINER_ID /bin/bash
```
Opens a shell inside a running container, allowing you to execute additional commands.

## Docker Image Layers
Docker images are composed of multiple layers. Each layer represents a set of changes made to the image during its creation. When a new container is created, a **writable layer** (called the "container layer") is added on top of the **read-only layers**. This structure ensures efficient storage and reuse of common layers across images.

## Docker Networking
Docker allows you to isolate containers into networks, enabling seamless communication between them without requiring explicit port bindings.

### List Networks
```bash
docker network ls
```

### Create a Network
```bash
docker network create NETWORK_NAME
```

## Docker Compose
Docker Compose is a tool for defining and managing multi-container applications using a `.yaml` file. Example:

```yaml
services:
  mongo:
    image: mongo
    ports:
      - "27017:27017"
    environment:
      MONGO_INITDB_ROOT_USERNAME: admin
      MONGO_INITDB_ROOT_PASSWORD: qwerty
    volumes:
      - ./data:/data/db

  mysql:
    image: mysql
    ports:
      - "3306:3306"
    environment:
      MYSQL_ROOT_PASSWORD: password
```

### Start Services
```bash
docker compose -f FILE_NAME.yaml up -d
```

### Stop and Remove Services
```bash
docker compose -f FILE_NAME.yaml down
```

## Dockerizing Your Application
To containerize your application, create a `Dockerfile`. Example for a Python app:

```dockerfile
# Base image
FROM python:3.12

# Set working directory
WORKDIR /usr/local/app

# Install dependencies
COPY requirements.txt ./
RUN pip install --no-cache-dir -r requirements.txt

# Copy source code
COPY src ./src

# Expose port
EXPOSE 5000

# Create and switch to a non-root user
RUN useradd app
USER app

# Default command
CMD ["uvicorn", "app.main:app", "--host", "0.0.0.0", "--port", "8080"]
```

### Common Instructions in a Dockerfile
- `FROM <image>`: Specifies the base image.
- `WORKDIR <path>`: Sets the working directory.
- `COPY <host-path> <image-path>`: Copies files from the host to the image.
- `RUN <command>`: Executes a command during the build process.
- `ENV <name> <value>`: Sets environment variables.
- `EXPOSE <port-number>`: Indicates the port the container will listen on.
- `USER <user-or-uid>`: Switches to a non-root user.
- `CMD ["<command>", "<arg1>"]`: Defines the default command for the container.

## Using .dockerignore
Create a `.dockerignore` file to exclude unnecessary files (e.g., `node_modules`) from being copied into the image:

```plaintext
node_modules
.git
*.log
```

## Building and Publishing Images

### Build the Image
```bash
docker build -t IMAGE_NAME:TAG .
```

### Publish the Image to Docker Hub
```bash
docker login
docker push IMAGE_NAME:TAG
```

## Docker Volumes
Volumes are used to persist data beyond the lifecycle of a container. Use the `-v` flag to mount a host directory into the container:
```bash
docker run -it -v HOST_PATH:CONTAINER_PATH IMAGE_NAME
```
